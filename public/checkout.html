<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Phone World</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Keep existing styles unchanged */
    body { background-color: #f8f9fa; }
    .checkout-container { max-width: 1200px; margin: 2rem auto; padding: 2rem; background: #fff; border-radius: 8px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
    .order-summary { background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border: 1px solid #e0e0e0; }
    .btn-place-order { background: #32BE8F; border: none; color: #fff; font-size: 1.2rem; padding: 1rem; border-radius: 8px; }
    .btn-place-order:hover { background: #2aa87a; }
    .payment-methods .nav-link { cursor: pointer; }
    .form-control:focus { box-shadow: none; border-color: #32BE8F; }
    .upi-qr { text-align: center; padding: 20px; border: 2px dashed #e0e0e0; border-radius: 8px; }
    .upi-qr img { max-width: 200px; margin: 10px 0; }
  </style>
</head>
<body>
  <!-- Navbar (unchanged) -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark" style="margin-bottom: 10px;">
    <div class="container-fluid">
      <!-- Brand/Logo -->
      <svg width="130" height="50" viewBox="0 0 714 130" fill="none" xmlns="http://www.w3.org/2000/svg">
          
        <rect x="2.5" y="2.5" width="709" height="125" rx="27.5" stroke="#32BE8F" stroke-width="5"/>
        <path d="M390.826 98L373.138 36.1818H387.415L397.648 79.1346H398.161L409.45 36.1818H421.675L432.934 79.2251H433.477L443.71 36.1818H457.987L440.299 98H427.561L415.789 57.5827H415.306L403.564 98H390.826ZM518.303 67.0909C518.303 73.8321 517.026 79.5672 514.47 84.2962C511.934 89.0251 508.473 92.6372 504.086 95.1325C499.72 97.6076 494.81 98.8452 489.356 98.8452C483.863 98.8452 478.933 97.5975 474.566 95.1023C470.199 92.607 466.748 88.9949 464.213 84.266C461.677 79.537 460.409 73.812 460.409 67.0909C460.409 60.3497 461.677 54.6146 464.213 49.8857C466.748 45.1567 470.199 41.5547 474.566 39.0795C478.933 36.5843 483.863 35.3366 489.356 35.3366C494.81 35.3366 499.72 36.5843 504.086 39.0795C508.473 41.5547 511.934 45.1567 514.47 49.8857C517.026 54.6146 518.303 60.3497 518.303 67.0909ZM505.052 67.0909C505.052 62.7242 504.398 59.0417 503.09 56.0433C501.802 53.045 499.981 50.7711 497.627 49.2216C495.273 47.6721 492.516 46.8974 489.356 46.8974C486.197 46.8974 483.44 47.6721 481.086 49.2216C478.731 50.7711 476.9 53.045 475.592 56.0433C474.304 59.0417 473.66 62.7242 473.66 67.0909C473.66 71.4576 474.304 75.1402 475.592 78.1385C476.9 81.1368 478.731 83.4107 481.086 84.9602C483.44 86.5097 486.197 87.2844 489.356 87.2844C492.516 87.2844 495.273 86.5097 497.627 84.9602C499.981 83.4107 501.802 81.1368 503.09 78.1385C504.398 75.1402 505.052 71.4576 505.052 67.0909ZM527.985 98V36.1818H552.374C557.043 36.1818 561.027 37.0169 564.328 38.6871C567.648 40.3372 570.173 42.6816 571.904 45.7202C573.655 48.7386 574.53 52.2904 574.53 56.3754C574.53 60.4805 573.645 64.0121 571.874 66.9702C570.103 69.9081 567.537 72.1619 564.177 73.7315C560.836 75.3011 556.791 76.0859 552.042 76.0859H535.712V65.5817H549.929C552.425 65.5817 554.497 65.2396 556.147 64.5554C557.798 63.8712 559.025 62.8449 559.83 61.4766C560.655 60.1082 561.068 58.4078 561.068 56.3754C561.068 54.3228 560.655 52.5922 559.83 51.1836C559.025 49.775 557.787 48.7084 556.117 47.984C554.467 47.2395 552.384 46.8672 549.869 46.8672H541.055V98H527.985ZM561.369 69.8679L576.733 98H562.305L547.273 69.8679H561.369ZM583.766 98V36.1818H596.836V87.2241H623.339V98H583.766ZM653.908 98H631.994V36.1818H654.089C660.307 36.1818 665.66 37.4194 670.147 39.8945C674.635 42.3495 678.086 45.8812 680.501 50.4893C682.936 55.0975 684.153 60.6113 684.153 67.0305C684.153 73.4699 682.936 79.0038 680.501 83.6321C678.086 88.2604 674.615 91.8121 670.087 94.2873C665.579 96.7624 660.186 98 653.908 98ZM645.064 86.8015H653.365C657.228 86.8015 660.478 86.1173 663.114 84.7489C665.771 83.3604 667.763 81.2173 669.091 78.3196C670.439 75.4018 671.113 71.6387 671.113 67.0305C671.113 62.4626 670.439 58.7298 669.091 55.832C667.763 52.9343 665.781 50.8013 663.145 49.4329C660.508 48.0645 657.259 47.3803 653.395 47.3803H645.064V86.8015Z" fill="#32BE8F"/>
        <rect x="12" y="11" width="344" height="108" rx="30" fill="#32BE8F"/>
        <path d="M37.6268 96V34.1818H62.016C66.7047 34.1818 70.6991 35.0773 73.9993 36.8683C77.2995 38.6391 79.8149 41.1042 81.5455 44.2635C83.2962 47.4027 84.1715 51.0249 84.1715 55.13C84.1715 59.2351 83.2861 62.8572 81.5153 65.9964C79.7444 69.1357 77.1787 71.5806 73.8182 73.3313C70.4777 75.082 66.433 75.9574 61.684 75.9574H46.1389V65.4833H59.571C62.0864 65.4833 64.1591 65.0507 65.7891 64.1854C67.4392 63.3 68.6667 62.0825 69.4716 60.533C70.2966 58.9634 70.7092 57.1624 70.7092 55.13C70.7092 53.0774 70.2966 51.2865 69.4716 49.7571C68.6667 48.2076 67.4392 47.0103 65.7891 46.1651C64.139 45.2998 62.0462 44.8672 59.5107 44.8672H50.6967V96H37.6268ZM92.661 96V34.1818H105.731V59.6879H132.263V34.1818H145.303V96H132.263V70.4638H105.731V96H92.661ZM212.886 65.0909C212.886 71.8321 211.609 77.5672 209.053 82.2962C206.517 87.0251 203.056 90.6372 198.669 93.1325C194.303 95.6076 189.393 96.8452 183.939 96.8452C178.446 96.8452 173.516 95.5975 169.149 93.1023C164.782 90.607 161.331 86.9949 158.796 82.266C156.26 77.537 154.992 71.812 154.992 65.0909C154.992 58.3497 156.26 52.6146 158.796 47.8857C161.331 43.1567 164.782 39.5547 169.149 37.0795C173.516 34.5843 178.446 33.3366 183.939 33.3366C189.393 33.3366 194.303 34.5843 198.669 37.0795C203.056 39.5547 206.517 43.1567 209.053 47.8857C211.609 52.6146 212.886 58.3497 212.886 65.0909ZM199.635 65.0909C199.635 60.7242 198.981 57.0417 197.673 54.0433C196.386 51.045 194.564 48.7711 192.21 47.2216C189.856 45.6721 187.099 44.8974 183.939 44.8974C180.78 44.8974 178.023 45.6721 175.669 47.2216C173.314 48.7711 171.483 51.045 170.175 54.0433C168.887 57.0417 168.243 60.7242 168.243 65.0909C168.243 69.4576 168.887 73.1402 170.175 76.1385C171.483 79.1368 173.314 81.4107 175.669 82.9602C178.023 84.5097 180.78 85.2844 183.939 85.2844C187.099 85.2844 189.856 84.5097 192.21 82.9602C194.564 81.4107 196.386 79.1368 197.673 76.1385C198.981 73.1402 199.635 69.4576 199.635 65.0909ZM274.275 34.1818V96H262.985L236.091 57.092H235.638V96H222.568V34.1818H234.038L260.722 73.0597H261.265V34.1818H274.275ZM285.073 96V34.1818H326.728V44.9577H298.143V59.6879H324.585V70.4638H298.143V85.2241H326.849V96H285.073Z" fill="#212529"/>
        </svg>
  
      <!-- Toggler -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
  
      <!-- Navbar Links + EJS Logic -->
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="/homepage">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/products.html">Products</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/orders.html">My Orders</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/about.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/contactus.html">Contact us</a>
          </li>
        </ul>
  
        
      
        </div>
      </div>
    </div>
  </nav>

  <!-- Checkout Section -->
  <div class="container checkout-container">
    <h2 class="mb-4">Checkout</h2>
    <div class="row">
      <div class="col-lg-7">
        <form id="checkout-form">
          <!-- Billing Details -->
          <div class="mb-3">
            <label for="fullName" class="form-label">Full Name</label>
            <input type="text" class="form-control" id="fullName" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email Address</label>
            <input type="email" class="form-control" id="email" required>
          </div>
          <div class="mb-3">
            <label for="phone" class="form-label">Phone Number</label>
            <input type="tel" class="form-control" id="phone" required>
          </div>
          <div class="mb-3">
            <label for="address" class="form-label">Shipping Address</label>
            <textarea class="form-control" id="address" rows="3" required></textarea>
          </div>

          <!-- Payment Method -->
          <hr>
          <h4 class="mb-3">Payment Method</h4>
          <input type="hidden" id="paymentMethod" name="paymentMethod" value="upi">
          
          <ul class="nav nav-pills mb-3 payment-methods" id="payment-tabs">
            <li class="nav-item">
              <a class="nav-link active" id="upi-tab" data-bs-toggle="pill" href="#upi">UPI</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="cod-tab" data-bs-toggle="pill" href="#cod">Cash on Delivery</a>
            </li>
          </ul>

          <div class="tab-content" id="paymentTabContent">
            <div class="tab-pane fade show active" id="upi">
              <!-- UPI content if needed -->
            </div>
            <div class="tab-pane fade" id="cod">
              <div class="alert alert-success">
                <h5>Cash on Delivery Selected</h5>
                <p>You will pay when the product is delivered.</p>
                <p>The invoice will be delivered with the order</p>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn-place-order w-100 mt-4">Make Payment</button>
        </form>
      </div>

      <!-- Order Summary -->
      <div class="col-lg-5">
        <div class="order-summary">
          <h4>Order Summary</h4>
          <dl class="row mb-3">
            <dt class="col-6">Subtotal:</dt>
            <dd class="col-6 text-end">₹<span id="subtotal">0.00</span></dd>
            <dt class="col-6">Shipping:</dt>
            <dd class="col-6 text-end">₹<span id="shipping">0.00</span></dd>
            <dt class="col-6">Tax:</dt>
            <dd class="col-6 text-end">₹<span id="tax">0.00</span></dd>
          </dl>
          <hr>
          <dl class="row mb-4">
            <dt class="col-6 fw-bold">Total:</dt>
            <dd class="col-6 text-end fw-bold">₹<span id="total">0.00</span></dd>
          </dl>
          <p class="text-muted">Review your order details before placing the order.</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const paymentButton = document.querySelector('.btn-place-order');
      const paymentMethodField = document.getElementById('paymentMethod');

      // Load cart summary
      fetch('/cart')
        .then(response => {
          if (!response.ok) throw new Error('Failed to load cart');
          return response.json();
        })
        .then(cartItems => {
          const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
          const total = subtotal.toFixed(2);
          
          document.getElementById('subtotal').textContent = total;
          document.getElementById('total').textContent = total;

          if (subtotal <= 0) {
            paymentButton.style.display = 'none';
            const emptyMsg = document.createElement('div');
            emptyMsg.className = 'alert alert-info mt-4';
            emptyMsg.textContent = 'Your cart is empty';
            document.querySelector('.checkout-container').prepend(emptyMsg);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to load cart items');
        });

      // Handle payment tab changes
      document.querySelectorAll('#payment-tabs .nav-link').forEach(tab => {
        tab.addEventListener('shown.bs.tab', event => {
          const paymentMethod = event.target.id.replace('-tab', '');
          paymentMethodField.value = paymentMethod;
          paymentButton.textContent = paymentMethod === 'cod' 
            ? 'Place Order' 
            : 'Make Payment';
        });
      });

      // Handle form submission
      document.getElementById('checkout-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const paymentMethod = paymentMethodField.value;
        const formData = {
          fullName: document.getElementById('fullName').value,
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value,
          address: document.getElementById('address').value,
          paymentMethod: paymentMethod
        };

        try {
          const response = await fetch('/checkout', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });

          const result = await response.json();
          if (result.success) {
            if (paymentMethod === 'cod') {
              alert('Order placed successfully!');
              window.location.href = '/homepage';
            } else {
              window.location.href = `/payment.html?orderId=${result.orderId}&username=${result.username}`;
            }
          } else {
            alert(`Error: ${result.message}`);
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Failed to place order. Please try again.');
        }
      });
    });
  </script>
</body>
</html>